let scartgoods=document.querySelectorAll("[data-scart=card]"),cartBox=document.querySelector("[data-scart=cartbox]"),counter=document.querySelector("[data-scart=counter]"),miniSum=document.querySelector("[data-scart=minisum] > span");miniSum&&(miniSum.textContent=0);let byeButton=document.querySelectorAll("[data-scart=button]");document.querySelector("[data-scart=row] [data-scart=img]").removeAttribute("srcset");let sCart,rowCart=document.querySelector("[data-scart=row]").cloneNode(!0),productsWrp=document.querySelector("[data-scart=row]").parentElement,formResultInput=document.createElement("textarea");function deleteCart(){document.querySelectorAll("[data-scart=row]").forEach((t=>{t.remove()}))}function ProdObj(t,e,r,a){this.title=t,this.img=e,this.price=r,this.description=a}function addToCard(t){let e=new ProdObj(t.querySelector("[data-scart=title]").innerText,t.querySelector("[data-scart=img]").src,parseInt(t.querySelector("[data-scart=price]").innerText.replace(/[^0-9.]/gim,"")),updatePrice(t)),r=JSON.stringify(e);if(r in sCart){let t=+sCart[r]+1;sCart[r]=t,localStorage.setItem("sCart",JSON.stringify(sCart)),refreshCart()}else sCart[r]=1,localStorage.setItem("sCart",JSON.stringify(sCart)),refreshCart()}function createIdObject(t){let e=t.querySelector("[data-scart=title]").innerText,r=t.querySelector("[data-scart=description]").innerText,a=new ProdObj(e,t.querySelector("[data-scart=img]").src,parseInt(t.querySelector("[data-scart=price]").innerText.replace(/[^0-9.]/gim,"")),r);return JSON.stringify(a)}function refreshCart(){deleteCart();let t=0,e=0;if(localStorage.getItem("sCart")){let r=Object.keys(JSON.parse(localStorage.getItem("sCart"))),a="";for(let s of r){let r=JSON.parse(s);null==sCart[s]&&localStorage.removeItem("sCart"),rowCart.querySelector("[data-scart=title]").innerText=r.title,rowCart.querySelector("[data-scart=description]").innerText=r.description,rowCart.querySelector("[data-scart=img]").src=r.img,t+=r.price*sCart[s],rowCart.querySelector("[data-scart=price]").innerHTML=String(r.price).replace(/\B(?=(\d{3})+(?!\d))/g,"&thinsp;"),rowCart.querySelector("[data-scart=count]").innerText=sCart[s],e+=+rowCart.querySelector("[data-scart=count]").innerHTML,productsWrp.append(rowCart),rowCart=document.querySelector("[data-scart=row]").cloneNode(!0),a+=`${r.title} — ${sCart[s]} шт. — цена: ${r.price}\n${r.description}&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;\n\r`}let s=String(t).replace(/\B(?=(\d{3})+(?!\d))/g,"&thinsp;");miniSum&&(miniSum.innerHTML=s,0==e?(counter.classList.remove("scart-show"),cartBox.classList.remove("scart-show")):(counter.classList.add("scart-show"),cartBox.classList.add("scart-show")),counter.textContent=e),document.querySelector("[data-scart=sum] > span").innerHTML=s,a+=`Сумма: ${s}`,formResultInput.innerHTML=a}}formResultInput.name="Заказ",formResultInput.style.display="none",document.querySelector("[data-scart=sum]").after(formResultInput),localStorage.getItem("sCart")?sCart=JSON.parse(localStorage.getItem("sCart")):(sCart={},localStorage.setItem("sCart",JSON.stringify(sCart))),deleteCart(),refreshCart(),document.onclick=t=>{if("remove"==t.target.getAttribute("data-scart")){let e=t.target.closest("[data-scart=row]");delete sCart[createIdObject(e)],localStorage.setItem("sCart",JSON.stringify(sCart)),refreshCart()}else if("minus"==t.target.getAttribute("data-scart")){let e=createIdObject(t.target.closest("[data-scart=row]"));sCart[e]>1&&(sCart[e]-=1,localStorage.setItem("sCart",JSON.stringify(sCart)),refreshCart())}else if("plus"==t.target.getAttribute("data-scart")){let e=createIdObject(t.target.closest("[data-scart=row]"));sCart[e]+=1,localStorage.setItem("sCart",JSON.stringify(sCart)),refreshCart()}},byeButton.forEach((t=>{t.onclick=function(){addToCard(this.closest("[data-scart=card]"))}}));let observer=new MutationObserver((()=>{if(0==productsWrp.childElementCount&&$('[data-remodal-id = "cart"]').length>0){$('[data-remodal-id = "cart"]').remodal().close()}}));function updatePrice(t){let e=+t.getAttribute("data-initial-price"),r="",a=1;return t.querySelectorAll(".opt-active").forEach((t=>{e+=+t.getAttribute("data-scart-cost"),r+=t.closest("[data-scart=options-box]").getAttribute("data-scart-description")+" : "+t.querySelector("div").textContent+"\n",t.hasAttribute("data-scart-discount")&&(a=t.getAttribute("data-scart-discount"))})),t.querySelector("[data-scart=price]").innerHTML=String(Math.round(e*a)).replace(/\B(?=(\d{3})+(?!\d))/g,"&thinsp;"),a<1?(t.querySelector("[data-scart=old-price]").innerHTML=String(e).replace(/\B(?=(\d{3})+(?!\d))/g,"&thinsp;"),t.querySelector("[data-scart=old-price]").parentElement.style.visibility="visible"):t.querySelector("[data-scart=old-price]").parentElement.style.visibility="hidden",r}observer.observe(productsWrp,{childList:!0,subtree:!0}),document.querySelectorAll("[data-scart=options-box] > div").forEach((t=>{t.addEventListener("click",(e=>{t.getAttribute("data-scart-description");let r=t.closest("[data-scart=options-box]").children;for(let t of r)t.classList.remove("opt-active");t.classList.add("opt-active"),updatePrice(t.closest("[data-scart=card]"))}))})),scartgoods.forEach((t=>{t.setAttribute("data-initial-price",t.querySelector("[data-scart=price]").textContent.replace(/\s/g,"")),updatePrice(t)}));